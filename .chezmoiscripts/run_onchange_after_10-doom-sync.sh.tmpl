#!/usr/bin/env bash
# ABOUTME: Syncs Doom Emacs when configuration changes are detected
# ABOUTME: Runs 'doom env' to generate environment variables and 'doom sync' to sync packages
#
# Hash: Doom config files for change detection
# init.el:    {{ include "dot_doom.d/init.el" | sha256sum }}
# config.el:  {{ include "dot_doom.d/config.el" | sha256sum }}
# packages.el: {{ include "dot_doom.d/packages.el" | sha256sum }}

set -euo pipefail

# Check if Doom Emacs is installed
if [[ ! -d "$HOME/.emacs.d/bin" ]]; then
    echo "⚠ Doom Emacs is not installed at ~/.emacs.d"
    echo "  Skipping Doom sync"
    exit 0
fi

# Ensure doom is in PATH for this script
export PATH="$HOME/.emacs.d/bin:$PATH"

echo "Syncing Doom Emacs..."

# Generate Doom environment variables
echo "Generating Doom environment..."
doom env

# Sync Doom packages
echo "Syncing Doom packages..."
doom sync

echo "✓ Doom Emacs synced successfully"
