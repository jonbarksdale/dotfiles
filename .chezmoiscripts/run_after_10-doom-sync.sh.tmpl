#!/usr/bin/env bash
# ABOUTME: Syncs Doom Emacs environment and packages after dotfiles are applied
# ABOUTME: Runs 'doom env' to generate environment variables and 'doom sync' to sync packages

set -euo pipefail

# Find Doom installation
DOOM_BIN=""
if [[ -f "$HOME/.config/emacs/bin/doom" ]]; then
    DOOM_BIN="$HOME/.config/emacs/bin/doom"
elif [[ -f "$HOME/.emacs.d/bin/doom" ]]; then
    DOOM_BIN="$HOME/.emacs.d/bin/doom"
else
    echo "⚠ Doom Emacs is not installed"
    echo "  Skipping Doom sync"
    exit 0
fi

echo "Syncing Doom Emacs..."

# Generate Doom environment variables
echo "Generating Doom environment..."
"$DOOM_BIN" env

# Sync Doom packages
echo "Syncing Doom packages..."
"$DOOM_BIN" sync

echo "✓ Doom Emacs synced successfully"
